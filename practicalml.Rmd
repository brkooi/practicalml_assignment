---
title: "Untitled"
author: "Ben Kooi"
date: "16-9-2021"
output: html_document
---

```{r setEnvironment, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load libraries
packages <- c("caret", "randomForest", "gbm", "janitor", "dplyr", "ggplot2")
sapply(packages, require, character.only=TRUE, quietly=TRUE)
```

## Synopsis

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Prepare datasets
```{r prepareData, include=FALSE}
# load trianing and testing datasets
data <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv")
testing <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv")

# remove empty columns from testing-dataset
testing <- remove_empty(testing, which = "cols")

# read the columnnames from the testing-dataset in a list
columnnames <- names(testing)

# remove the columname 'problem_id' from the list
columnnames <- columnnames[columnnames != "problem_id"]

# add the columname 'classe' to the list
columnnames <- c(columnnames, "classe")

# remove unnecessary columns from the dataframe
data <- subset(data, select = -c(X, user_name, raw_timestamp_part_1, raw_timestamp_part_2, num_window, new_window, cvtd_timestamp) )

# remove all the columns with a total 
data <- data %>% select(-contains(c('total')))

# convert 'classe'-variable to factor
data$classe <- as.factor(data$classe)

# print the structure of the dataframe
str(data)

# create training and validation-sets
trainIndex <- createDataPartition(data$classe, p=0.8, list=FALSE)
training <- data[ trainIndex,]
validation <- data[-trainIndex,]

set.seed(123)

# train the Random Forest-algorithm with all the variables and default tuning-parameters
modelRf <- train(classe ~ ., data=training, method="rf")

# print the model
modelRf

# predict the values of the 'classe'-variable on the dataset 'validation'
predictRf <- predict(modelRf, validation)

# Cross-validation of the prediction
confusionMatrix(predictRf,validation$classe)

# train the Gradient Boosting-algorithm with all the variables and default tuning-parameters
modelGbm <- train(classe ~ ., data=training, method="gbm"
                  , verbose = FALSE)
# print the model
modelGbm

# predict the values of the 'classe'-variable on the dataset 'validation'
predictGbm <- predict(modelGbm, validation)

# Cross-validation of the prediction
confusionMatrix(predictGbm,validation$classe)

```


## Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(modelRf, main="Random Forest - Amount of variables randomly selected for treebuilding vs. Accuracy")
plot(modelRf$finalModel, main="Random Forest - Amount of trees vs. Error-rate")
plot(varImp(modelRf), main="Random Forest - Order of importance of used variables")
plot(varImp(modelGbm),main="Gradient Boosting - Order of importance of used variables")
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
